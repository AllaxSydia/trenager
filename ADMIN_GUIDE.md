# Руководство администратора

## Система ролей

В проекте реализована система ролей для разделения доступа между студентами и преподавателями.

### Роли пользователей

- **student** (студент) - роль по умолчанию для всех зарегистрированных пользователей
- **teacher** (преподаватель) - роль с расширенными правами доступа

### Назначение пользователя преподавателем

Чтобы назначить пользователя преподавателем, выполните SQL запрос в базе данных:

```sql
UPDATE users 
SET role = 'teacher' 
WHERE email = 'email_пользователя@example.com';
```

Или по username:

```sql
UPDATE users 
SET role = 'teacher' 
WHERE username = 'имя_пользователя';
```

### Возможности преподавателей

1. **Доступ к странице статистики** (`/admin/statistics`)
   - Просмотр статистики по всем студентам
   - Количество решенных задач
   - Процент успешности
   - Статистика по языкам программирования

2. **Автоматическое сохранение решений**
   - Все решения задач студентов автоматически сохраняются в базу данных
   - Преподаватели могут видеть прогресс каждого студента

### API Endpoints

#### Получение статистики (только для преподавателей)

```
GET /api/admin/statistics
Authorization: Bearer <token>
```

**Ответ:**
```json
{
  "total_students": 10,
  "total_solutions": 45,
  "students": [
    {
      "user_id": 1,
      "username": "student1",
      "email": "student1@example.com",
      "total_tasks": 5,
      "solved_tasks": 4,
      "success_rate": 80.0,
      "languages": {
        "python": {
          "total_tasks": 3,
          "solved_tasks": 2,
          "success_rate": 66.67
        }
      }
    }
  ]
}
```

### Структура базы данных

#### Таблица `users`
- `id` - уникальный идентификатор
- `username` - имя пользователя
- `email` - email
- `password_hash` - хеш пароля
- `role` - роль пользователя ('student' или 'teacher')
- `created_at` - дата создания
- `updated_at` - дата обновления

#### Таблица `task_solutions`
- `id` - уникальный идентификатор
- `user_id` - ID пользователя (FK)
- `task_id` - ID задачи
- `language` - язык программирования
- `code` - код решения
- `success` - успешно ли решена задача
- `passed_tests` - количество пройденных тестов
- `total_tests` - общее количество тестов
- `created_at` - дата создания

### Безопасность

- Все административные endpoints защищены middleware `TeacherOnlyMiddleware`
- Проверка роли происходит на уровне JWT токена
- Студенты не могут получить доступ к статистике даже при прямом обращении к API

### Примечания

- При регистрации все пользователи получают роль 'student' по умолчанию
- Роль сохраняется в JWT токене при авторизации
- Для изменения роли пользователя требуется прямой доступ к базе данных

